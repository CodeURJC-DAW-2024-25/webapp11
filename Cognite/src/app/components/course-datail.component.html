
<main class="container mt-4">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">Contenidos</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#material" type="button" role="tab">Material</button>
      </li>
    </ul>
  
    <div class="tab-content mt-3">
      <!-- CONTENIDOS -->
      <div class="tab-pane fade show active" id="content" role="tabpanel">
        <img [src]="'/api/v1/courses/' + course.id + '/image'" alt="Imagen del curso" class="img-fluid mb-3" style="max-height: 300px; object-fit: cover;">
        <h2>{{ course.title }}</h2>
        <h6>Valoración: {{ course.rating }} ⭐</h6>
        <h5>Profesor: {{ course.instructor.firstName }}</h5>
        <p><strong>Temática:</strong> {{ course.topic }}</p>
        <p>Descripción: {{ course.description }}</p>
  
        <h4 class="mt-4">Comentarios</h4>
        <div *ngIf="reviews?.length; else noComments">
          <div *ngFor="let review of reviews" class="comment mb-3">
            <strong>{{ review.user.firstName }} {{ review.user.lastName }}</strong>
            <p>{{ review.text }}</p>
  
            <div *ngFor="let reply of review.sons" class="comment ms-3">
              <strong>{{ reply.user.firstName }} {{ reply.user.lastName }}</strong>
              <p>{{ reply.text }}</p>
  
              <form *ngIf="isTeacher" [action]="'/reviews/' + reply.id + '/mark-pending'" method="post">
                <input type="hidden" name="_csrf" [value]="token" />
                <button class="btn btn-link btn-sm text-danger ms-2">Reportar</button>
              </form>
            </div>
  
            <form *ngIf="isEnrolled || isTeacher" action="/course/newReview" method="post">
              <input type="hidden" name="courseId" [value]="course.id">
              <input type="hidden" name="parentId" [value]="review.id">
              <input type="hidden" name="_csrf" [value]="token" />
              <textarea class="form-control mb-2" name="text" placeholder="Responder..."></textarea>
              <input type="submit" class="btn btn-link btn-sm" value="Responder">
            </form>
  
            <form *ngIf="isTeacher" [action]="'/reviews/' + review.id + '/mark-pending'" method="post" style="display: inline;">
              <input type="hidden" name="_csrf" [value]="token" />
              <button class="btn btn-link btn-sm text-danger ms-2">Reportar</button>
            </form>
          </div>
        </div>
        <ng-template #noComments>
          <p><br>No hay comentarios aún.</p>
        </ng-template>
  
        <hr>
  
        <!-- Añadir nuevo comentario -->
        <form *ngIf="isEnrolled || isTeacher" action="/course/newReview" method="post">
          <input type="hidden" name="courseId" [value]="course.id">
          <input type="hidden" name="_csrf" [value]="token" />
          <textarea class="form-control mb-2" name="text" placeholder="Añadir un comentario..."></textarea>
          <button class="btn btn-primary">Comentar</button>
        </form>
  
        <p *ngIf="!isEnrolled && !isTeacher">
          <a href="/login">Inicia sesión</a> e inscríbete al curso para dejar un comentario.
        </p>
      </div>
  
      <!-- MATERIAL -->
      <div class="tab-pane fade" id="material" role="tabpanel">
        <h4>Previsualización del material</h4>
  
        <ng-container *ngIf="isEnrolled || isTeacher; else noAccess">
          <object [data]="'/course/' + course.id + '/notes'" type="application/pdf" width="100%" height="400px">
            <p>Tu navegador no admite la visualización de PDFs.
              <a [href]="'/course/' + course.id + '/notes'" target="_blank">Haz clic aquí para verlo</a>.
            </p>
          </object>
        </ng-container>
        <ng-template #noAccess>
          <p>Debe inscribirse al curso para poder ver el material</p>
        </ng-template>
  
        <div *ngIf="isTeacher" class="mt-3">
          <a [routerLink]="['/editCourse', course.id]">
            <button class="btn btn-success">Editar curso</button>
          </a>
          <a [routerLink]="['/deleteCourse', course.id]">
            <button class="btn btn-danger">Eliminar curso</button>
          </a>
          <a [routerLink]="['/statistics', course.id]" class="btn btn-secondary">Ver estadísticas</a>
        </div>
      </div>
  
      <!-- BOTÓN INSCRIBIRSE -->
      <form *ngIf="!isEnrolled && !isTeacher" method="post" action="/course/enroll">
        <button type="submit" class="btn btn-success mt-3">Inscribirse al curso</button>
        <input type="hidden" name="_csrf" [value]="token" />
        <input type="hidden" name="idCourse" [value]="course.id" />
      </form>
  
      <!-- VALORACIÓN -->
      <div *ngIf="isEnrolled" class="mt-4">
        <hr>
        <h4>Califica el curso</h4>
        <form method="post" action="/enrollment/rate" class="p-3 bg-light">
          <div class="d-flex align-items-center gap-3">
            <select id="rating" name="rating" class="form-select" style="width: auto;">
              <option *ngFor="let r of [0,1,2,3,4,5]" [value]="r">{{ r }} ⭐</option>
            </select>
            <button type="submit" class="btn btn-success ms-2">
              <i class="bi bi-star-fill"></i> Valorar
            </button>
          </div>
          <input type="hidden" name="_csrf" [value]="token" />
          <input type="hidden" name="courseId" [value]="course.id" />
        </form>
      </div>
  
      <div class="text-center mt-4">
        <a routerLink="/" class="btn btn-primary">Volver a la página principal</a>
      </div>
    </div>
  </main>
  